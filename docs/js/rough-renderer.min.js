!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).r2={})}(this,function(t){"use strict";function e(e,t){var s,n=Object.keys(e);return Object.getOwnPropertySymbols&&(s=Object.getOwnPropertySymbols(e),t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)),n}function o(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(Object(a),!0).forEach(function(t){var e,s;e=n,s=a[t=t],t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))})}return n}function l(t,e){if(null==t)return{};var s,n=function(t,e){if(null==t)return{};for(var s,n={},a=Object.keys(t),r=0;r<a.length;r++)s=a[r],0<=e.indexOf(s)||(n[s]=t[s]);return n}(t,e);if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(t),r=0;r<a.length;r++)s=a[r],0<=e.indexOf(s)||Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s]);return n}function c(t,e,s){if(t&&t.length){const[n,a]=e,r=Math.PI/180*s,o=Math.cos(r),h=Math.sin(r);t.forEach(t=>{var[e,s]=t;t[0]=(e-n)*o-(s-a)*h+n,t[1]=(e-n)*h+(s-a)*o+a})}}function g(t){var e=t[0],t=t[1];return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function i(t,e){var s=e.hachureAngle+90;let n=e.hachureGap;n<0&&(n=4*e.strokeWidth),n=Math.max(n,.1);var a=[0,0];if(s)for(const e of t)c(e,a,s);e=function(e,s){const n=[];for(const s of e){const e=[...s];e[0].join(",")!==e[e.length-1].join(",")&&e.push([e[0][0],e[0][1]]),2<e.length&&n.push(e)}const a=[],r=(s=Math.max(s,.1),[]);for(const e of n)for(let t=0;t<e.length-1;t++){const n=e[t],a=e[t+1];if(n[1]!==a[1]){const e=Math.min(n[1],a[1]);r.push({ymin:e,ymax:Math.max(n[1],a[1]),x:(e===n[1]?n:a)[0],islope:(a[0]-n[0])/(a[1]-n[1])})}}if(r.sort((t,e)=>t.ymin<e.ymin?-1:t.ymin>e.ymin?1:t.x<e.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax)),!r.length)return a;let o=[],h=r[0].ymin;for(;o.length||r.length;){if(r.length){let e=-1;for(let t=0;t<r.length&&!(r[t].ymin>h);t++)e=t;r.splice(0,e+1).forEach(t=>{o.push({s:h,edge:t})})}if((o=o.filter(t=>!(t.edge.ymax<=h))).sort((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x)),1<o.length)for(let t=0;t<o.length;t+=2){const s=t+1;if(s>=o.length)break;const n=o[t].edge,r=o[s].edge;a.push([[Math.round(n.x),h],[Math.round(r.x),h]])}h+=s,o.forEach(t=>{t.edge.x=t.edge.x+s*t.edge.islope})}return a}(t,n);if(s){for(const e of t)c(e,a,-s);{t=a;var r=-s;const o=[];e.forEach(t=>o.push(...t)),c(o,t,r)}}return e}class a{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){t=i(t,e);return{type:"fillSketch",ops:this.renderLines(t,e)}}renderLines(t,e){const s=[];for(const n of t)s.push(...this.helper.doubleLineOps(n[0][0],n[0][1],n[1][0],n[1][1],e));return s}}class r extends a{fillPolygons(t,e){let s=e.hachureGap;s<0&&(s=4*e.strokeWidth),s=Math.max(s,.1);const n=i(t,Object.assign({},e,{hachureGap:s})),a=Math.PI/180*e.hachureAngle,r=[],o=.5*s*Math.cos(a),h=.5*s*Math.sin(a);for(const[t,i]of n)g([t,i])&&r.push([[t[0]-o,t[1]+h],[...i]],[[t[0]+o,t[1]-h],[...i]]);return{type:"fillSketch",ops:this.renderLines(r,e)}}}class p extends a{fillPolygons(t,e){const s=this._fillPolygons(t,e),n=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),a=this._fillPolygons(t,n);return s.ops=s.ops.concat(a.ops),s}}class f{constructor(t){this.helper=t}fillPolygons(t,e){t=i(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(t,e)}dotsOnLines(t,e){const s=[];let n=e.hachureGap,a=(n<0&&(n=4*e.strokeWidth),n=Math.max(n,.1),e.fillWeight);a<0&&(a=e.strokeWidth/2);var r=n/4;for(const o of t){const t=g(o),h=t/n,i=Math.ceil(h)-1,l=t-i*n,c=(o[0][0]+o[1][0])/2-n/4,u=Math.min(o[0][1],o[1][1]);for(let t=0;t<i;t++){const g=u+l+t*n,p=c-r+2*Math.random()*r,f=g-r+2*Math.random()*r,d=this.helper.ellipse(p,f,a,a,e);s.push(...d.ops)}}return{type:"fillSketch",ops:s}}}class d{constructor(t){this.helper=t}fillPolygons(t,e){t=i(t,e);return{type:"fillSketch",ops:this.dashedLine(t,e)}}dashedLine(t,h){const i=h.dashOffset<0?h.hachureGap<0?4*h.strokeWidth:h.hachureGap:h.dashOffset,l=h.dashGap<0?h.hachureGap<0?4*h.strokeWidth:h.hachureGap:h.dashGap,c=[];return t.forEach(t=>{const e=g(t),s=Math.floor(e/(i+l)),n=(e+l-s*(i+l))/2;let a=t[0],r=t[1];a[0]>r[0]&&(a=t[1],r=t[0]);var o=Math.atan((r[1]-a[1])/(r[0]-a[0]));for(let t=0;t<s;t++){const g=t*(i+l),e=g+i,s=[a[0]+g*Math.cos(o)+n*Math.cos(o),a[1]+g*Math.sin(o)+n*Math.sin(o)],r=[a[0]+e*Math.cos(o)+n*Math.cos(o),a[1]+e*Math.sin(o)+n*Math.sin(o)];c.push(...this.helper.doubleLineOps(s[0],s[1],r[0],r[1],h))}}),c}}class m{constructor(t){this.helper=t}fillPolygons(t,e){var s=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,n=e.zigzagOffset<0?s:e.zigzagOffset,t=i(t,e=Object.assign({},e,{hachureGap:s+n}));return{type:"fillSketch",ops:this.zigzagLines(t,n,e)}}zigzagLines(t,i,l){const c=[];return t.forEach(t=>{const e=g(t),s=Math.round(e/(2*i));let n=t[0],a=t[1];n[0]>a[0]&&(n=t[1],a=t[0]);var r=Math.atan((a[1]-n[1])/(a[0]-n[0]));for(let t=0;t<s;t++){const g=2*t*i,e=2*(t+1)*i,s=Math.sqrt(2*Math.pow(i,2)),a=[n[0]+g*Math.cos(r),n[1]+g*Math.sin(r)],o=[n[0]+e*Math.cos(r),n[1]+e*Math.sin(r)],h=[a[0]+s*Math.cos(r+Math.PI/4),a[1]+s*Math.sin(r+Math.PI/4)];c.push(...this.helper.doubleLineOps(a[0],a[1],h[0],h[1],l),...this.helper.doubleLineOps(h[0],h[1],o[0],o[1],l))}}),c}}const n={};class s{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const v={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function w(t,e){return t.type===e}function x(t){const s=[],n=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:""+parseFloat(RegExp.$1)},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let a="BOD",r=0,o=n[r];for(;!w(o,2);){let e=0;const h=[];if("BOD"===a){if("M"!==o.text&&"m"!==o.text)return x("M0,0"+t);r++,e=v[o.text],a=o.text}else w(o,1)?e=v[a]:(r++,e=v[o.text],a=o.text);if(!(r+e<n.length))throw new Error("Path data ended short");for(let t=r;t<r+e;t++){const s=n[t];if(!w(s,1))throw new Error("Param not a number: "+a+","+s.text);h[h.length]=+s.text}if("number"!=typeof v[a])throw new Error("Bad segment: "+a);{const t={key:a,data:h};s.push(t),r+=e,o=n[r],"m"===(a="M"===a?"L":a)&&(a="l")}}return s}function P(t){let s=0,n=0,e=0,a=0;const r=[];for(var{key:o,data:h}of t)switch(o){case"M":r.push({key:"M",data:[...h]}),[s,n]=h,[e,a]=h;break;case"m":s+=h[0],n+=h[1],r.push({key:"M",data:[s,n]}),e=s,a=n;break;case"L":r.push({key:"L",data:[...h]}),[s,n]=h;break;case"l":s+=h[0],n+=h[1],r.push({key:"L",data:[s,n]});break;case"C":r.push({key:"C",data:[...h]}),s=h[4],n=h[5];break;case"c":{const t=h.map((t,e)=>e%2?t+n:t+s);r.push({key:"C",data:t}),s=t[4],n=t[5];break}case"Q":r.push({key:"Q",data:[...h]}),s=h[2],n=h[3];break;case"q":{const t=h.map((t,e)=>e%2?t+n:t+s);r.push({key:"Q",data:t}),s=t[2],n=t[3];break}case"A":r.push({key:"A",data:[...h]}),s=h[5],n=h[6];break;case"a":s+=h[5],n+=h[6],r.push({key:"A",data:[h[0],h[1],h[2],h[3],h[4],s,n]});break;case"H":r.push({key:"H",data:[...h]}),s=h[0];break;case"h":s+=h[0],r.push({key:"H",data:[s]});break;case"V":r.push({key:"V",data:[...h]}),n=h[0];break;case"v":n+=h[0],r.push({key:"V",data:[n]});break;case"S":r.push({key:"S",data:[...h]}),s=h[2],n=h[3];break;case"s":{const t=h.map((t,e)=>e%2?t+n:t+s);r.push({key:"S",data:t}),s=t[2],n=t[3];break}case"T":r.push({key:"T",data:[...h]}),s=h[0],n=h[1];break;case"t":s+=h[0],n+=h[1],r.push({key:"T",data:[s,n]});break;case"Z":case"z":r.push({key:"Z",data:[]}),s=e,n=a}return r}function O(s){const n=[];let a="",r=0,o=0,h=0,t=0,i=0,l=0;for(var{key:e,data:c}of s){switch(e){case"M":n.push({key:"M",data:[...c]}),[r,o]=c,[h,t]=c;break;case"C":n.push({key:"C",data:[...c]}),r=c[4],o=c[5],i=c[2],l=c[3];break;case"L":n.push({key:"L",data:[...c]}),[r,o]=c;break;case"H":r=c[0],n.push({key:"L",data:[r,o]});break;case"V":o=c[0],n.push({key:"L",data:[r,o]});break;case"S":{let t=0,e=0;e="C"===a||"S"===a?(t=r+(r-i),o+(o-l)):(t=r,o),n.push({key:"C",data:[t,e,...c]}),i=c[0],l=c[1],r=c[2],o=c[3];break}case"T":{const[s,h]=c;let t=0,e=0;e="Q"===a||"T"===a?(t=r+(r-i),o+(o-l)):(t=r,o);var u=r+2*(t-r)/3,p=o+2*(e-o)/3,f=s+2*(t-s)/3,d=h+2*(e-h)/3;n.push({key:"C",data:[u,p,f,d,s,h]}),i=t,l=e,r=s,o=h;break}case"Q":{const[s,a,h,t]=c,g=r+2*(s-r)/3,M=o+2*(a-o)/3,k=h+2*(s-h)/3,b=t+2*(a-t)/3;n.push({key:"C",data:[g,M,k,b,h,t]}),i=s,l=a,r=h,o=t;break}case"A":{const s=Math.abs(c[0]),a=Math.abs(c[1]),h=c[2],t=c[3],i=c[4],l=c[5],y=c[6];0===s||0===a?(n.push({key:"C",data:[r,o,l,y,l,y]}),r=l,o=y):r===l&&o===y||(function u(e,p,s,n,a,r,o,f,d,h){t=o;const g=Math.PI*t/180;var t;let i=[],l=0,c=0,M=0,k=0;if(h)[l,c,M,k]=h;else{[e,p]=A(e,p,-g),[s,n]=A(s,n,-g);const o=(e-s)/2,h=(p-n)/2;let t=o*o/(a*a)+h*h/(r*r);1<t&&(t=Math.sqrt(t),a*=t,r*=t);const i=a*a,u=r*r,b=i*u-i*h*h-u*o*o,y=i*h*h+u*o*o,m=(f===d?-1:1)*Math.sqrt(Math.abs(b/y));M=m*a*h/r+(e+s)/2,k=m*-r*o/a+(p+n)/2,l=Math.asin(parseFloat(((p-k)/r).toFixed(9))),c=Math.asin(parseFloat(((n-k)/r).toFixed(9))),e<M&&(l=Math.PI-l),s<M&&(c=Math.PI-c),l<0&&(l=2*Math.PI+l),c<0&&(c=2*Math.PI+c),d&&l>c&&(l-=2*Math.PI),!d&&c>l&&(c-=2*Math.PI)}let b=c-l;if(Math.abs(b)>120*Math.PI/180){const e=c,p=s,f=n;c=d&&c>l?l+120*Math.PI/180*1:l+120*Math.PI/180*-1,i=u(s=M+a*Math.cos(c),n=k+r*Math.sin(c),p,f,a,r,o,0,d,[c,e,M,k])}b=c-l;const y=Math.cos(l),m=Math.sin(l),v=Math.cos(c),w=Math.sin(c),x=Math.tan(b/4),P=4/3*a*x,O=4/3*r*x,S=[e,p],L=[e+P*m,p-O*y],T=[s+P*w,n-O*v],D=[s,n];if(L[0]=2*S[0]-L[0],L[1]=2*S[1]-L[1],h)return[L,T,D].concat(i);{i=[L,T,D].concat(i);const e=[];for(let t=0;t<i.length;t+=3){const s=A(i[t][0],i[t][1],g),n=A(i[t+1][0],i[t+1][1],g),a=A(i[t+2][0],i[t+2][1],g);e.push([s[0],s[1],n[0],n[1],a[0],a[1]])}return e}}(r,o,l,y,s,a,h,t,i).forEach(function(t){n.push({key:"C",data:t})}),r=l,o=y);break}case"Z":n.push({key:"Z",data:[]}),r=h,o=t}a=e}return n}function A(t,e,s){return[t*Math.cos(s)-e*Math.sin(s),t*Math.sin(s)+e*Math.cos(s)]}const S={randOffset:function(t,e){return k(t,e)},randOffsetWithRange:function(t,e,s){return E(t,e,s)},ellipse:function(t,e,s,n,a){return j(t,e,a,D(s,n,a)).opset},doubleLineOps:function(t,e,s,n,a){return b(t,e,s,n,a,!0)}};function L(t,e,s,n,a){return{type:"path",ops:b(t,e,s,n,a)}}function T(e,t,s){var n=(e||[]).length;if(2<n){const a=[];for(let t=0;t<n-1;t++)a.push(...b(e[t][0],e[t][1],e[t+1][0],e[t+1][1],s));return t&&a.push(...b(e[n-1][0],e[n-1][1],e[0][0],e[0][1],s)),{type:"path",ops:a}}return 2===n?L(e[0][0],e[0][1],e[1][0],e[1][1],s):{type:"path",ops:[]}}function D(t,e,s){var n=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),n=Math.ceil(Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*n)),n=2*Math.PI/n,t=Math.abs(t/2),e=Math.abs(e/2),a=1-s.curveFitting;return{increment:n,rx:t+=k(t*a,s),ry:e+=k(e*a,s)}}function j(t,e,s,n){const[a,r]=R(n.increment,t,e,n.rx,n.ry,1,n.increment*E(.1,E(.4,1,s),s),s);let o=G(a,null,s);if(!s.disableMultiStroke&&0!==s.roughness){const[a]=R(n.increment,t,e,n.rx,n.ry,1.5,0,s),r=G(a,null,s);o=o.concat(r)}return{estimatedPoints:r,opset:{type:"path",ops:o}}}function I(t,e,s,n,c,u,p,f,a){var r=t,s=Math.abs(s/2),n=Math.abs(n/2);s+=k(.01*s,a),n+=k(.01*n,a);let o=c,h=u;for(;o<0;)o+=2*Math.PI,h+=2*Math.PI;h-o>2*Math.PI&&(o=0,h=2*Math.PI);const d=2*Math.PI/a.curveStepCount,i=Math.min(d/2,(h-o)/2),l=$(i,r,e,s,n,o,h,1,a);if(!a.disableMultiStroke){const t=$(i,r,e,s,n,o,h,1.5,a);l.push(...t)}return p&&(f?l.push(...b(r,e,r+s*Math.cos(o),e+n*Math.sin(o),a),...b(r,e,r+s*Math.cos(h),e+n*Math.sin(h),a)):l.push({op:"lineTo",data:[r,e]},{op:"lineTo",data:[r+s*Math.cos(o),e+n*Math.sin(o)]})),{type:"path",ops:l}}function _(e,s){const n=[];for(const a of e)if(a.length){const e=s.maxRandomnessOffset||0,r=a.length;if(2<r){n.push({op:"move",data:[a[0][0]+k(e,s),a[0][1]+k(e,s)]});for(let t=1;t<r;t++)n.push({op:"lineTo",data:[a[t][0]+k(e,s),a[t][1]+k(e,s)]})}}return{type:"fillPath",ops:n}}function M(t,e){return function(t,e){let s=t.fillStyle||"hachure";if(!n[s])switch(s){case"zigzag":n[s]||(n[s]=new r(e));break;case"cross-hatch":n[s]||(n[s]=new p(e));break;case"dots":n[s]||(n[s]=new f(e));break;case"dashed":n[s]||(n[s]=new d(e));break;case"zigzag-line":n[s]||(n[s]=new m(e));break;default:s="hachure",n[s]||(n[s]=new a(e))}return n[s]}(e,S).fillPolygons(t,e)}function C(t){return t.randomizer||(t.randomizer=new s(t.seed||0)),t.randomizer.next()}function E(t,e,s,n=1){return s.roughness*n*(C(s)*(e-t)+t)}function k(t,e,s=1){return E(-t,t,e,s)}function b(t,e,s,n,a,r=!1){const o=r?a.disableMultiStrokeFill:a.disableMultiStroke,h=W(t,e,s,n,a,!0,!1);if(o)return h;r=W(t,e,s,n,a,!0,!0);return h.concat(r)}function W(t,e,s,n,a,c,u){var r=Math.pow(t-s,2)+Math.pow(e-n,2),o=Math.sqrt(r);let p,f=(p=o<200?1:500<o?.4:-.0016668*o+1.233334,a.maxRandomnessOffset||0);const d=(f=f*f*100>r?o/10:f)/2,h=.2+.2*C(a);r=a.bowing*a.maxRandomnessOffset*(n-e)/200,o=a.bowing*a.maxRandomnessOffset*(t-s)/200,r=k(r,a,p),o=k(o,a,p);const g=[],i=()=>k(d,a,p),M=()=>k(f,a,p),l=a.preserveVertices;return c&&(u?g.push({op:"move",data:[t+(l?0:i()),e+(l?0:i())]}):g.push({op:"move",data:[t+(l?0:k(f,a,p)),e+(l?0:k(f,a,p))]})),u?g.push({op:"bcurveTo",data:[r+t+(s-t)*h+i(),o+e+(n-e)*h+i(),r+t+2*(s-t)*h+i(),o+e+2*(n-e)*h+i(),s+(l?0:i()),n+(l?0:i())]}):g.push({op:"bcurveTo",data:[r+t+(s-t)*h+M(),o+e+(n-e)*h+M(),r+t+2*(s-t)*h+M(),o+e+2*(n-e)*h+M(),s+(l?0:M()),n+(l?0:M())]}),g}function z(e,s,n){const a=[];a.push([e[0][0]+k(s,n),e[0][1]+k(s,n)]),a.push([e[0][0]+k(s,n),e[0][1]+k(s,n)]);for(let t=1;t<e.length;t++)a.push([e[t][0]+k(s,n),e[t][1]+k(s,n)]),t===e.length-1&&a.push([e[t][0]+k(s,n),e[t][1]+k(s,n)]);return G(a,null,n)}function G(e,t,s){const n=e.length,a=[];if(3<n){const r=[],o=1-s.curveTightness;a.push({op:"move",data:[e[1][0],e[1][1]]});for(let t=1;t+2<n;t++){const s=e[t];r[0]=[s[0],s[1]],r[1]=[s[0]+(o*e[t+1][0]-o*e[t-1][0])/6,s[1]+(o*e[t+1][1]-o*e[t-1][1])/6],r[2]=[e[t+1][0]+(o*e[t][0]-o*e[t+2][0])/6,e[t+1][1]+(o*e[t][1]-o*e[t+2][1])/6],r[3]=[e[t+1][0],e[t+1][1]],a.push({op:"bcurveTo",data:[r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]]})}if(t&&2===t.length){const e=s.maxRandomnessOffset;a.push({op:"lineTo",data:[t[0]+k(e,s),t[1]+k(e,s)]})}}else 3===n?(a.push({op:"move",data:[e[1][0],e[1][1]]}),a.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):2===n&&a.push(...b(e[0][0],e[0][1],e[1][0],e[1][1],s));return a}function R(e,s,n,a,r,o,t,h){const c=[],i=[],l=k(.5,h)-Math.PI/2,u=0===h.roughness;u||i.push([k(o,h)+s+.9*a*Math.cos(l-e),k(o,h)+n+.9*r*Math.sin(l-e)]);var p=2*Math.PI+(u?0:l-.01);for(let t=l;t<p;t+=e){const e=[k(o,h)+s+a*Math.cos(t),k(o,h)+n+r*Math.sin(t)];c.push(e),i.push(e)}return u||(i.push([k(o,h)+s+a*Math.cos(l+2*Math.PI+.5*t),k(o,h)+n+r*Math.sin(l+2*Math.PI+.5*t)]),i.push([k(o,h)+s+.98*a*Math.cos(l+t),k(o,h)+n+.98*r*Math.sin(l+t)]),i.push([k(o,h)+s+.9*a*Math.cos(l+.5*t),k(o,h)+n+.9*r*Math.sin(l+.5*t)])),[i,c]}function $(e,s,n,a,r,t,o,h,i){const l=t+k(.1,i),c=[];c.push([k(h,i)+s+.9*a*Math.cos(l-e),k(h,i)+n+.9*r*Math.sin(l-e)]);for(let t=l;t<=o;t+=e)c.push([k(h,i)+s+a*Math.cos(t),k(h,i)+n+r*Math.sin(t)]);return c.push([s+a*Math.cos(o),n+r*Math.sin(o)]),c.push([s+a*Math.cos(o),n+r*Math.sin(o)]),G(c,null,i)}function h(t){return[...t]}function q(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function y(t,e,s){return[t[0]+(e[0]-t[0])*s,t[1]+(e[1]-t[1])*s]}function F(e,s,n,t,c){const a=c||[],u=e[s],p=e[n-1];let r=0,f=1;for(let t=s+1;t<n-1;++t){o=e[t],l=void 0;const s=0===(l=q(h=u,i=p))?q(o,h):(l=((o[0]-h[0])*(i[0]-h[0])+(o[1]-h[1])*(i[1]-h[1]))/l,q(o,y(h,i,Math.max(0,Math.min(1,l)))));s>r&&(r=s,f=t)}var o,h,i,l;return Math.sqrt(r)>t?(F(e,s,f+1,t,a),F(e,f,n,t,a)):(a.length||a.push(u),a.push(p)),a}function V(e,s=.15,t){var n=[],a=(e.length-1)/3;for(let t=0;t<a;t++)!function c(o,h,t,u){const e=u||[];if(function(){var t=o[h+0],e=o[h+1],s=o[h+2],n=o[h+3];let a=3*e[0]-2*t[0]-n[0],r=(a*=a,3*e[1]-2*t[1]-n[1]);return r*=r,e=3*s[0]-2*n[0]-t[0],e*=e,s=3*s[1]-2*n[1]-t[1],s*=s,a<e&&(a=e),r<s&&(r=s),a+r}()<t){const t=o[h+0];e.length?(s=e[e.length-1],n=t,1<Math.sqrt(q(s,n))&&e.push(t)):e.push(t),e.push(o[h+3])}else{const u=.5,s=o[h+0],n=o[h+1],a=o[h+2],r=o[h+3],i=y(s,n,.5),l=y(n,a,.5),p=y(a,r,.5),f=y(i,l,.5),d=y(l,p,.5),g=y(f,d,.5);c([s,i,f,g],0,t,e),c([g,d,p,r],0,t,e)}var s,n;return e}(e,3*t,s,n);return t&&0<t?F(n,0,n.length,t):n}const u="none";class Z{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}line(t,e,s,n,a){a=this._o(a);return this._d("line",[L(t,e,s,n,a)],a)}rectangle(t,e,s,n,a){const r=this._o(a),o=[],h=T([[t,e],[t+s,e],[t+s,e+n],[t,e+n]],!0,r);if(r.fill){const a=[[t,e],[t+s,e],[t+s,e+n],[t,e+n]];"solid"===r.fillStyle?o.push(_([a],r)):o.push(M([a],r))}return r.stroke!==u&&o.push(h),this._d("rectangle",o,r)}ellipse(t,e,s,n,a){const r=this._o(a),o=[],h=D(s,n,r),i=j(t,e,r,h);if(r.fill)if("solid"===r.fillStyle){const s=j(t,e,r,h).opset;s.type="fillPath",o.push(s)}else o.push(M([i.estimatedPoints],r));return r.stroke!==u&&o.push(i.opset),this._d("ellipse",o,r)}circle(t,e,s,n){const a=this.ellipse(t,e,s,s,n);return a.shape="circle",a}linearPath(t,e){e=this._o(e);return this._d("linearPath",[T(t,!1,e)],e)}arc(t,e,s,n,a,r,o=!1,h){const i=this._o(h),l=[],c=I(t,e,s,n,a,r,o,!0,i);if(o&&i.fill)if("solid"===i.fillStyle){const o=Object.assign({},i),h=I(t,e,s,n,a,r,o.disableMultiStroke=!0,!1,o);h.type="fillPath",l.push(h)}else l.push(function(t,e,c,u,p,f,s){var n=t,a=e,r=Math.abs(c/2),o=Math.abs(u/2);r+=k(.01*r,s),o+=k(.01*o,s);let h=p,i=f;for(;h<0;)h+=2*Math.PI,i+=2*Math.PI;i-h>2*Math.PI&&(h=0,i=2*Math.PI);const d=(i-h)/s.curveStepCount,l=[];for(let t=h;t<=i;t+=d)l.push([n+r*Math.cos(t),a+o*Math.sin(t)]);return l.push([n+r*Math.cos(i),a+o*Math.sin(i)]),l.push([n,a]),M([l],s)}(t,e,s,n,a,r,i));return i.stroke!==u&&l.push(c),this._d("arc",l,i)}curve(t,e){const s=this._o(e),n=[],a=function(t,e){let s=z(t,1+.2*e.roughness,e);return e.disableMultiStroke||(t=z(t,1.5*(1+.22*e.roughness),function(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}(e)),s=s.concat(t)),{type:"path",ops:s}}(t,s);if(s.fill&&s.fill!==u&&3<=t.length){const e=V(function(e,s=0){const n=e.length;if(n<3)throw new Error("A curve must have at least three points.");const a=[];if(3===n)a.push(h(e[0]),h(e[1]),h(e[2]),h(e[2]));else{const n=[];n.push(e[0],e[0]);for(let t=1;t<e.length;t++)n.push(e[t]),t===e.length-1&&n.push(e[t]);const r=[],o=1-s;a.push(h(n[0]));for(let t=1;t+2<n.length;t++){const s=n[t];r[0]=[s[0],s[1]],r[1]=[s[0]+(o*n[t+1][0]-o*n[t-1][0])/6,s[1]+(o*n[t+1][1]-o*n[t-1][1])/6],r[2]=[n[t+1][0]+(o*n[t][0]-o*n[t+2][0])/6,n[t+1][1]+(o*n[t][1]-o*n[t+2][1])/6],r[3]=[n[t+1][0],n[t+1][1]],a.push(r[1],r[2],r[3])}}return a}(t),10,(1+s.roughness)/2);"solid"===s.fillStyle?n.push(_([e],s)):n.push(M([e],s))}return s.stroke!==u&&n.push(a),this._d("curve",n,s)}polygon(t,e){const s=this._o(e),n=[],a=T(t,!0,s);return s.fill&&("solid"===s.fillStyle?n.push(_([t],s)):n.push(M([t],s))),s.stroke!==u&&n.push(a),this._d("polygon",n,s)}path(t,e){const s=this._o(e),n=[];if(!t)return this._d("path",n,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const a=s.fill&&"transparent"!==s.fill&&s.fill!==u,r=s.stroke!==u,o=!!(s.simplification&&s.simplification<1),h=function(t,e,s){const c=O(P(x(t))),n=[];let a=[],r=[0,0],o=[];const h=()=>{4<=o.length&&a.push(...V(o,e)),o=[]},i=()=>{h(),a.length&&(n.push(a),a=[])};for(const{key:t,data:e}of c)switch(t){case"M":i(),r=[e[0],e[1]],a.push(r);break;case"L":h(),a.push([e[0],e[1]]);break;case"C":if(!o.length){const t=a.length?a[a.length-1]:r;o.push([t[0],t[1]])}o.push([e[0],e[1]]),o.push([e[2],e[3]]),o.push([e[4],e[5]]);break;case"Z":h(),a.push([r[0],r[1]])}if(i(),!s)return n;const l=[];for(const t of n){const e=F(t,0,t.length,s);e.length&&l.push(e)}return l}(t,1,o?4-4*s.simplification:(1+s.roughness)/2);return a&&("solid"===s.fillStyle?n.push(_(h,s)):n.push(M(h,s))),r&&(o?h.forEach(t=>{n.push(T(t,!1,s))}):n.push(function(e,s){const n=O(P(x(e))),t=[];let a=[0,0],r=[0,0];for(const{key:e,data:o}of n)switch(e){case"M":{const e=+(s.maxRandomnessOffset||0),n=s.preserveVertices;t.push({op:"move",data:o.map(t=>t+(n?0:k(e,s)))}),r=[o[0],o[1]],a=[o[0],o[1]];break}case"L":t.push(...b(r[0],r[1],o[0],o[1],s)),r=[o[0],o[1]];break;case"C":{const[e,n,a,h,i,l]=o;t.push(...function(e,s,u,p,n,a,r,o){const h=[],i=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.3];var l,f=o.disableMultiStroke?1:2,c=o.preserveVertices;for(let t=0;t<f;t++)0===t?h.push({op:"move",data:[r[0],r[1]]}):h.push({op:"move",data:[r[0]+(c?0:k(i[0],o)),r[1]+(c?0:k(i[0],o))]}),l=c?[n,a]:[n+k(i[t],o),a+k(i[t],o)],h.push({op:"bcurveTo",data:[e+k(i[t],o),s+k(i[t],o),u+k(i[t],o),p+k(i[t],o),l[0],l[1]]});return h}(e,n,a,h,i,l,r,s)),r=[i,l];break}case"Z":t.push(...b(r[0],r[1],a[0],a[1],s)),r=[a[0],a[1]]}return{type:"path",ops:t}}(t,s))),this._d("path",n,s)}opsToPath(t,e){let s="";for(const n of t.ops){const t="number"==typeof e&&0<=e?n.data.map(t=>+t.toFixed(e)):n.data;switch(n.op){case"move":s+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":s+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":s+=`L${t[0]} ${t[1]} `}}return s.trim()}toPaths(e){const t=e.sets||[],s=e.options||this.defaultOptions,n=[];for(const e of t){let t=null;switch(e.type){case"path":t={d:this.opsToPath(e),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:u};break;case"fillPath":t={d:this.opsToPath(e),stroke:u,strokeWidth:0,fill:s.fill||u};break;case"fillSketch":t=this.fillSketch(e,s)}t&&n.push(t)}return n}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||u,strokeWidth:s,fill:u}}}class Q{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new Z(e)}draw(t){const e=t.sets||[],s=t.options||this.getDefaultOptions(),n=this.ctx,a=t.options.fixedDecimalPlaceDigits;for(const r of e)switch(r.type){case"path":n.save(),n.strokeStyle="none"===s.stroke?"transparent":s.stroke,n.lineWidth=s.strokeWidth,s.strokeLineDash&&n.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(n.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(n,r,a),n.restore();break;case"fillPath":{n.save(),n.fillStyle=s.fill||"";const e="curve"===t.shape||"polygon"===t.shape||"path"===t.shape?"evenodd":"nonzero";this._drawToContext(n,r,a,e),n.restore();break}case"fillSketch":this.fillSketch(n,r,s)}}fillSketch(t,e,s){let n=s.fillWeight;n<0&&(n=s.strokeWidth/2),t.save(),s.fillLineDash&&t.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(t.lineDashOffset=s.fillLineDashOffset),t.strokeStyle=s.fill||"",t.lineWidth=n,this._drawToContext(t,e,s.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,s,n="nonzero"){t.beginPath();for(const n of e.ops){const e="number"==typeof s&&0<=s?n.data.map(t=>+t.toFixed(s)):n.data;switch(n.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(n):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,s,n,a){t=this.gen.line(t,e,s,n,a);return this.draw(t),t}rectangle(t,e,s,n,a){t=this.gen.rectangle(t,e,s,n,a);return this.draw(t),t}ellipse(t,e,s,n,a){t=this.gen.ellipse(t,e,s,n,a);return this.draw(t),t}circle(t,e,s,n){t=this.gen.circle(t,e,s,n);return this.draw(t),t}linearPath(t,e){t=this.gen.linearPath(t,e);return this.draw(t),t}polygon(t,e){t=this.gen.polygon(t,e);return this.draw(t),t}arc(t,e,s,n,a,r,o=!1,h){t=this.gen.arc(t,e,s,n,a,r,o,h);return this.draw(t),t}curve(t,e){t=this.gen.curve(t,e);return this.draw(t),t}path(t,e){t=this.gen.path(t,e);return this.draw(t),t}}const H="http://www.w3.org/2000/svg";class N{constructor(t,e){this.svg=t,this.gen=new Z(e)}draw(e){const t=e.sets||[],s=e.options||this.getDefaultOptions(),n=this.svg.ownerDocument||window.document,a=n.createElementNS(H,"g"),r=e.options.fixedDecimalPlaceDigits;for(const o of t){let t=null;switch(o.type){case"path":(t=n.createElementNS(H,"path")).setAttribute("d",this.opsToPath(o,r)),t.setAttribute("stroke",s.stroke),t.setAttribute("stroke-width",s.strokeWidth+""),t.setAttribute("fill","none"),s.strokeLineDash&&t.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&t.setAttribute("stroke-dashoffset",""+s.strokeLineDashOffset);break;case"fillPath":(t=n.createElementNS(H,"path")).setAttribute("d",this.opsToPath(o,r)),t.setAttribute("stroke","none"),t.setAttribute("stroke-width","0"),t.setAttribute("fill",s.fill||""),"curve"!==e.shape&&"polygon"!==e.shape||t.setAttribute("fill-rule","evenodd");break;case"fillSketch":t=this.fillSketch(n,o,s)}t&&a.appendChild(t)}return a}fillSketch(t,e,s){let n=s.fillWeight;n<0&&(n=s.strokeWidth/2);const a=t.createElementNS(H,"path");return a.setAttribute("d",this.opsToPath(e,s.fixedDecimalPlaceDigits)),a.setAttribute("stroke",s.fill||""),a.setAttribute("stroke-width",n+""),a.setAttribute("fill","none"),s.fillLineDash&&a.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&a.setAttribute("stroke-dashoffset",""+s.fillLineDashOffset),a}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,s,n,a){t=this.gen.line(t,e,s,n,a);return this.draw(t)}rectangle(t,e,s,n,a){t=this.gen.rectangle(t,e,s,n,a);return this.draw(t)}ellipse(t,e,s,n,a){t=this.gen.ellipse(t,e,s,n,a);return this.draw(t)}circle(t,e,s,n){t=this.gen.circle(t,e,s,n);return this.draw(t)}linearPath(t,e){t=this.gen.linearPath(t,e);return this.draw(t)}polygon(t,e){t=this.gen.polygon(t,e);return this.draw(t)}arc(t,e,s,n,a,r,o=!1,h){t=this.gen.arc(t,e,s,n,a,r,o,h);return this.draw(t)}curve(t,e){t=this.gen.curve(t,e);return this.draw(t)}path(t,e){t=this.gen.path(t,e);return this.draw(t)}}var B={canvas:(t,e)=>new Q(t,e),svg:(t,e)=>new N(t,e),generator:t=>new Z(t),newSeed:()=>Z.newSeed()};function J(t){var e=t.node,e=B.svg(e);return o(o({},t),{},{rough:e})}var K=["x1","y1","x2","y2"],U=["width","height","x","y"],X=["d"],Y=["cx","cy","r","fill"];function tt(t,e){return at(t,"line",e.x1,e.y1,e.x2,e.y2,l(e,K))}function et(t,e){var s=e.width,n=e.height,a=e.x,r=e.y,e=l(e,U);return at(t,"rectangle",0<s?a:a+s,0<n?r:r+n,Math.abs(s),Math.abs(n),e)}function st(t,e){var s=e.d,e=l(e,X);return at(t,"path",Array.isArray(s)?s.flat().join(" "):s,e)}function nt(t,e){var s=e.cx,n=e.cy,a=e.r,r=e.fill,r="transparent"===r?void 0:r;return at(t,"circle",s,n,2*a,o(o({},l(e,Y)),{},{fill:r}))}function at(t,e){for(var s=t.group,t=t.rough,n=arguments.length,a=new Array(2<n?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];e=t[e].apply(t,a);return t=e,(s=s)&&s.appendChild(t),e}t.createPlugin=function(){return{line:tt,circle:nt,rect:et,path:st,context:J}},Object.defineProperty(t,"__esModule",{value:!0})});
